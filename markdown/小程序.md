#### 小程序

问题：https://blog.csdn.net/feiyue0823/article/details/90815213

appid：wx9918b73e283c4163

| AppID(小程序ID)    |      |
| ------------------ | ---- |
| wx9918b73e283c4163 |      |

1. 配置

   project.config.json：项目配置

   app.json：小程序全局配置

   page.json：页面独立配置



2. 说明

   

3. 可以做直播



云开发：

1. 创建数据库

   ![image-20200316151943723](/Users/su/Library/Application Support/typora-user-images/image-20200316151943723.png)

2. 连接并查询

   ```javascript
   const db = wx.cloud.database()
   
   page({
     getList() {
       // 获取分页数据
       const ret = db.collection('books')
       							.orderBy('create_time', 'desc')
       							.skip(10)
       							.limit(10)
       							.get()
       							.then(res => {
                       console.log(res.data)
                     })
       // 插入数据
       db.collection('books').add({
         data: obj,
         success: res => {
           // ...
         }
       })
     }
   })
   ```

   

云函数：（爬取豆瓣数据）

1. 创建云函数

   ![image-20200317184740257](/Users/su/Library/Application Support/typora-user-images/image-20200317184740257.png)

2. 安装依赖

   ```javascript
   npm install axios cheerio --save
   npm install
   ```

3. 编写代码

   ```javascript
   // 云函数入口文件
   const cloud = require('wx-server-sdk')
   const axios = require('axios')
   const cheerio = require('cheerio')
   const doubanbook = require('doubanbook')
   const qs = require('qs')
   
   cloud.init()
   
   // getDouban('9787559445735')
   async function searchDouban(code) {
     let searchInfo = await axios.get('https://search.douban.com/book/subject_search?search_text=' + code)
     let reg = /window\.__DATA__ = "(.*)"/
   
     if (reg.test(searchInfo.data)) {
       return doubanbook(RegExp.$1)[0]
     }
     return {}
   }
   
   async function getDouban(code) {
     let detail = await searchDouban(code)
     console.log('detail', detail)
     let detailPage = await axios.get(detail.url)
     let $ = cheerio.load(detailPage.data)
     let tags = []
   
     $('#db-tags-section a.tag').each((i, v) => {
       tags.push({
         title: $(v).text()
       })
     })
   
     const ret = {
       tags,
       create_time: Date.now(),
       image: detail.cover_url,
       rate: detail.rating.value,
       url: detail.url,
       title: detail.title,
       summary: $('#link-report .intro').text()
     }
   
     console.log('ret', ret)
   
     return ret
   }
   
   // 云函数入口函数
   exports.main = async (event, context) => {
     const wxContext = cloud.getWXContext()
     const { isbn } = event
     const data = await getDouban(isbn)
     return data
   }
   ```

4. 上传云函数，稍等几秒就上传好了

   ![image-20200317185124594](/Users/su/Library/Application Support/typora-user-images/image-20200317185124594.png)

5. 调用云函数

   ```javascript
   // 调用
   ...
   wx.cloud.callFunction({
     name: 'scanBook',
     data: {
       isbn: code
     },
     success: ({result}) => {
       console.log('result', result)
   		// 调用云开发的库
       db.collection('books').add({
         data: result,
         success: add => {
           if (add._id) {
             wx.hideLoading()
             wx.showModal({
               title: '添加成功！',
               content: `添加图书《${result.title}》`
             })
           }
         }
       })
     }
   })
   ...
   ```

   

6. 完成

   

   





小程序实践：

所有示例：https://developers.weixin.qq.com/community/servicemarket

要完成的：https://developers.weixin.qq.com/community/servicemarket/detail/00004e793c8488315b99cf00456815



Taro多端支持：

1. 安装：

   ```javascript
   // 报权限错误要执行sudo，还不行试试：sudo npm install -g --unsafe-perm @tarojs/cli
   npm install -g @tarojs/cli
   ```

2. 运行

   ```javascript
   taro init taro-demo
   cd taro-demo
   npm run dev:weapp // 运行微信端
   // 微信开发者工具打开当前目录下的dist，vscode打开taro-demo项目，即可开发
   ```

3. 

4. 































